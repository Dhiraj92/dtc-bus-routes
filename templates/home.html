{% extends "index.html" %}

{% block title %}DTC Buses Routes, Bus Timings and other information | {{ block.super }}{% endblock %}

{% block css %}
    {{ block.super}}
    <style>
    .homepagesegment {
        margin-top: 0 !important;
        margin-bottom: 0 !important;
        height:75%;
    }

    #map {
        height: 100%;
        padding: 0px;
    }

    .journeyforms {
        padding: 10px;
    }

    #tabbedForms {
        position:absolute;
        top: 0.5%;
        left: 2%;
        width:450px;
        z-index: 1000;
    }

    #ad_unit {
        height: 25%;
    }

    /* mobile view */
    @media only screen and (max-width: 767px) {
        #map {
            display:none;
        }

        #tabbedForms {
            position: relative;
            margin-left: auto;
            margin-right: auto;
            margin-top:0;
            width: 100%;
            left: 0;
        }
    }
    </style>
{% endblock %}

{% block body %}
        <div class="ui segments homepagesegment">
            <div class="ui clearing segment" id="map">
                <div class="ui active inverted dimmer">
                    <div class="ui text loader">Loading maps... hang on!</div>
                </div>
            </div>

            <div id="tabbedForms" class="ui raised card">
                <div class="content">
                    <div class="ui top attached tabular menu">
                        <div class="item active" data-tab="tab-trip-planner">Trip Planner</div>
                        <div class="item" data-tab="tab-route-details">Route Details</div>
                    </div>
                    <div class="ui tab bottom attached active segment" data-tab="tab-trip-planner">
                        <form class="ui form journeyforms">
                            <p>Get buses between two stops.</p>
                            <div class="field">
                                <label>From</label>
                                <div class="ui search focus stagesearch">
                                    <div class="ui icon input">
                                        <input class="prompt" type="text" name="stage1" placeholder="Source e.g. Badarpur Border" autocomplete="off">
                                        <i class="marker icon"></i>
                                    </div>
                                </div>
                            </div>
                            <div class="field">
                                <label>To</label>
                                <div class="ui search focus stagesearch">
                                    <div class="ui icon input">
                                        <input class="prompt" type="text" name="stage2" placeholder="Destination e.g. ISBT" autocomplete="off">
                                        <i class="marker icon"></i>
                                    </div>
                                </div>
                            </div>
                            <div class="ui blue submit button">Search</div>
                        </form>
                    </div>
                    <div class="ui tab bottom attached segment" data-tab="tab-route-details">
                        <form class="ui form journeyforms">
                            <p>Get all bus stops on a route.</p>
                            <div class="field">
                                <label>Route Name</label>
                                <div class="ui search focus routesearch">
                                    <div class="ui icon input">
                                        <input class="prompt" type="text" name="bus1" placeholder="Route name or bus number e.g. 182A" autocomplete="off">
                                        <i class="bus icon"></i>
                                    </div>
                                </div>
                            </div>
                            <div class="ui blue submit button">Search</div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
        <div id="ad_unit" class="row">
          <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
          <!-- Home Page Responsive -->
          <ins class="adsbygoogle"
          style="display:block; width:100%"
          data-ad-client="ca-pub-2660771687848747"
          data-ad-slot="5824987163"
          data-ad-format="horizontal"></ins>
          <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
          {% if debug %}
          google_ad_test = "on";
          {% endif %}
          </script>
        </div>
{% endblock %}


{% block js %}
{{ block.super }}

<script type="text/javascript">
$(document).ready(function() {
    $('.stagesearch').search({
        apiSettings: {
            url: "{% url 'ajax_stage_search' %}?q={query}",
            onResponse: function (response){
                $.each(response.results, function(index, item) {
                  var name   = item.name || 'Unknown';
                  cached_stages.push(name.trim());
                });
            }
        },
        fields: {
            results : 'results',
            title   : 'name',
        },
        minCharacters : 1
    });

    $('.routesearch').search({
        apiSettings: {
            url: "{% url 'ajax_bus_number_search' %}?q={query}",
            onResponse: function (response){
                $.each(response.results, function(index, item) {
                  var name = item.name || "Unknown";
                  cached_routes.push(name.trim());
                });
            }
        },
        fields: {
            results : 'results',
            title   : 'name',
        },
        minCharacters : 1
    });

    $('.tabular.menu .item').tab();


    $.fn.form.settings.rules.stageValid = function(value) {
        return $.inArray(value,cached_stages) >= 0;
    };

    $.fn.form.settings.rules.routeValid = function(value) {
        return $.inArray(value,cached_routes) >= 0;
    };

    $('.ui.form')
      .form({
        on: 'submit',
        inline: true,
        fields: {
              stage1: {
                rules: [
                  {
                    type   : 'empty',
                    prompt : 'Please enter source stop.'
                },
                  {
                    type   : 'stageValid',
                    prompt : 'Please select a stop from dropdown.'
                  }
                ]
              },
              stage2: {
                rules: [
                  {
                    type   : 'empty',
                    prompt : 'Please enter destination stop.'
                },
                  {
                    type   : 'stageValid',
                    prompt : 'Please select a stop from dropdown.'
                  }
                ]
              },
              bus1: {
                rules: [
                  {
                    type   : 'empty',
                    prompt : 'Please enter a bus number or route name.'
                },
                {
                  type   : 'routeValid',
                  prompt : 'Please enter a bus number or route name from dropdown.'
                }
              ]
            }
        }
    });
});
</script>
{% endblock %}
