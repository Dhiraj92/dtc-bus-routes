!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;"undefined"!=typeof window?t=window:"undefined"!=typeof global?t=global:"undefined"!=typeof self&&(t=self),t.mapmatching=e()}}(function(){var e;return function t(e,n,r){function o(u,a){if(!n[u]){if(!e[u]){var s="function"==typeof require&&require;if(!a&&s)return s(u,!0);if(i)return i(u,!0);var f=new Error("Cannot find module '"+u+"'");throw f.code="MODULE_NOT_FOUND",f}var c=n[u]={exports:{}};e[u][0].call(c.exports,function(t){var n=e[u][1][t];return o(n?n:t)},c,c.exports,t,e,n,r)}return n[u].exports}for(var i="function"==typeof require&&require,u=0;u<r.length;u++)o(r[u]);return o}({1:[function(e){"use strict";if(!L.mapbox)throw new Error("include mapbox.js before mapbox.match.js");L.mapbox.mapmatching=e("./src/match")},{"./src/match":14}],2:[function(e,t){function n(e,t){function n(e){return JSON.parse(JSON.stringify(e))}t=t||{};for(var o={minimumDistance:t.minimumDistance||10,minimumTime:t.minimumTime||5,maximumPoints:t.maximumPoints||100},i={type:"FeatureCollection",features:[]},u={type:"Feature",properties:{coordTimes:[]},geometry:{type:"LineString",coordinates:[]}},a=0;a<e.features.length;a++)if("LineString"==e.features[a].geometry.type){var s=e.features[a].geometry.coordinates,f=e.features[a].properties.coordTimes;i.features.push(n(u));for(var c=0;c<s.length;c++)if(0!==c&&c!=s.length-1){var p={latitude:s[c][1],longitude:s[c][0]},l={latitude:s[c+1][1],longitude:s[c+1][0]},d=1e3*r(p,l,{unit:"km"});if(!(d<o.minimumDistance)){if(f){var h=new Date(f[c]),m=new Date(f[c+1]),y=(m-h)/1e3;if(y<o.minimumTime)continue}i.features[i.features.length-1].geometry.coordinates.push(s[c]),f&&i.features[i.features.length-1].properties.coordTimes.push(f[c]),i.features[i.features.length-1].geometry.coordinates.length%o.maximumPoints===0&&(i.features.push(n(u)),i.features[i.features.length-1].geometry.coordinates.push(s[c]),f&&i.features[i.features.length-1].properties.coordTimes.push(f[c]))}}else i.features[i.features.length-1].geometry.coordinates.push(s[c]),f&&i.features[i.features.length-1].properties.coordTimes.push(f[c])}return i}var r=e("haversine");t.exports.tidy=n},{haversine:3}],3:[function(e,t){var n=function(){var e=function(e){return e*Math.PI/180};return function(t,n,r){var o=6371,i=3960;r=r||{};var u="mile"===r.unit?i:o,a=e(n.latitude-t.latitude),s=e(n.longitude-t.longitude),f=e(t.latitude),c=e(n.latitude),p=Math.sin(a/2)*Math.sin(a/2)+Math.sin(s/2)*Math.sin(s/2)*Math.cos(f)*Math.cos(c),l=2*Math.atan2(Math.sqrt(p),Math.sqrt(1-p));return r.threshold?r.threshold>u*l:u*l}}();t.exports=n},{}],4:[function(e,t){function n(e,t){e=Math.round(e*t),e<<=1,0>e&&(e=~e);for(var n="";e>=32;)n+=String.fromCharCode((32|31&e)+63),e>>=5;return n+=String.fromCharCode(e+63)}var r={};r.decode=function(e,t){for(var n,r,o=0,i=0,u=0,a=[],s=0,f=0,c=null,p=Math.pow(10,t||5);o<e.length;){c=null,s=0,f=0;do c=e.charCodeAt(o++)-63,f|=(31&c)<<s,s+=5;while(c>=32);n=1&f?~(f>>1):f>>1,s=f=0;do c=e.charCodeAt(o++)-63,f|=(31&c)<<s,s+=5;while(c>=32);r=1&f?~(f>>1):f>>1,i+=n,u+=r,a.push([i/p,u/p])}return a},r.encode=function(e,t){if(!e.length)return"";for(var r=Math.pow(10,t||5),o=n(e[0][0],r)+n(e[0][1],r),i=1;i<e.length;i++){var u=e[i],a=e[i-1];o+=n(u[0]-a[0],r),o+=n(u[1]-a[1],r)}return o},void 0!==typeof t&&(t.exports=r)},{}],5:[function(t,n,r){!function(t,o){"object"==typeof r&&"undefined"!=typeof n?n.exports=o():"function"==typeof e&&e.amd?e("queue",o):t.queue=o()}(this,function(){"use strict";function e(){}function t(t){function n(){if(!c)for(;c=h&&t>m;){var e=y+m,n=l[e],r=n.length-1,i=n[r];n[r]=u(e),--h,++m,l[e]=i.apply(null,n)||o}}function u(e){return function(t,r){if(!l[e])throw new Error;--m,++y,l[e]=null,null==p&&(null!=t?a(t):(d[e]=r,h?n():m||s()))}}function a(e){p=e,h=0/0,s()}function s(){null!=p?g(p):w?g(null,d):g.apply(null,i.concat(d))}if(!(t>=1))throw new Error;var f,c,p,l=[],d=[],h=0,m=0,y=0,g=e,w=!0;return f={defer:function(t){if(g!==e)throw new Error;var o=r.call(arguments,1);return o.push(t),++h,l.push(o),n(),f},abort:function(){if(null==p){for(var e,t=y+m;--t>=0;)(e=l[t])&&e.abort&&e.abort();a(new Error("abort"))}return f},await:function(t){if(g!==e)throw new Error;return g=t,w=!1,h||m||s(),f},awaitAll:function(t){if(g!==e)throw new Error;return g=t,w=!0,h||m||s(),f}}}function n(e){return t(arguments.length?+e:1/0)}var r=[].slice,o={},i=[null];return n.version="1.2.1",n})},{}],6:[function(e,t){"use strict";function n(e,t){for(var n=0;n<e.length;n++)t(e[n])}function r(e){for(var t in e)if(e.hasOwnProperty(t))return!1;return!0}function o(e,t,n){var r=e;return c(t)?(n=t,"string"==typeof e&&(r={uri:e})):r=l(t,{uri:e}),r.callback=n,r}function i(e,t,n){return t=o(e,t,n),u(t)}function u(e){function t(){4===c.readyState&&u()}function n(){var e=void 0;if(c.response?e=c.response:"text"!==c.responseType&&c.responseType||(e=c.responseText||c.responseXML),b)try{e=JSON.parse(e)}catch(t){}return e}function o(e){clearTimeout(h),e instanceof Error||(e=new Error(""+(e||"Unknown XMLHttpRequest Error"))),e.statusCode=0,a(e,s)}function u(){if(!d){var t;clearTimeout(h),t=e.useXDR&&void 0===c.status?200:1223===c.status?204:c.status;var r=s,o=null;0!==t?(r={body:n(),statusCode:t,method:y,headers:{},url:m,rawRequest:c},c.getAllResponseHeaders&&(r.headers=p(c.getAllResponseHeaders()))):o=new Error("Internal XMLHttpRequest Error"),a(o,r,r.body)}}var a=e.callback;if("undefined"==typeof a)throw new Error("callback argument missing");a=f(a);var s={body:void 0,headers:{},statusCode:0,method:y,url:m,rawRequest:c},c=e.xhr||null;c||(c=e.cors||e.useXDR?new i.XDomainRequest:new i.XMLHttpRequest);var l,d,h,m=c.url=e.uri||e.url,y=c.method=e.method||"GET",g=e.body||e.data||null,w=c.headers=e.headers||{},v=!!e.sync,b=!1;if("json"in e&&(b=!0,w.accept||w.Accept||(w.Accept="application/json"),"GET"!==y&&"HEAD"!==y&&(w["content-type"]||w["Content-Type"]||(w["Content-Type"]="application/json"),g=JSON.stringify(e.json))),c.onreadystatechange=t,c.onload=u,c.onerror=o,c.onprogress=function(){},c.ontimeout=o,c.open(y,m,!v,e.username,e.password),v||(c.withCredentials=!!e.withCredentials),!v&&e.timeout>0&&(h=setTimeout(function(){d=!0,c.abort("timeout");var e=new Error("XMLHttpRequest timeout");e.code="ETIMEDOUT",o(e)},e.timeout)),c.setRequestHeader)for(l in w)w.hasOwnProperty(l)&&c.setRequestHeader(l,w[l]);else if(e.headers&&!r(e.headers))throw new Error("Headers cannot be set on an XDomainRequest object");return"responseType"in e&&(c.responseType=e.responseType),"beforeSend"in e&&"function"==typeof e.beforeSend&&e.beforeSend(c),c.send(g),c}function a(){}var s=e("global/window"),f=e("once"),c=e("is-function"),p=e("parse-headers"),l=e("xtend");t.exports=i,i.XMLHttpRequest=s.XMLHttpRequest||a,i.XDomainRequest="withCredentials"in new i.XMLHttpRequest?i.XMLHttpRequest:s.XDomainRequest,n(["get","put","post","patch","head","delete"],function(e){i["delete"===e?"del":e]=function(t,n,r){return n=o(t,n,r),n.method=e.toUpperCase(),u(n)}})},{"global/window":7,"is-function":8,once:9,"parse-headers":12,xtend:13}],7:[function(e,t){(function(e){t.exports="undefined"!=typeof window?window:"undefined"!=typeof e?e:"undefined"!=typeof self?self:{}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],8:[function(e,t){function n(e){var t=r.call(e);return"[object Function]"===t||"function"==typeof e&&"[object RegExp]"!==t||"undefined"!=typeof window&&(e===window.setTimeout||e===window.alert||e===window.confirm||e===window.prompt)}t.exports=n;var r=Object.prototype.toString},{}],9:[function(e,t){function n(e){var t=!1;return function(){return t?void 0:(t=!0,e.apply(this,arguments))}}t.exports=n,n.proto=n(function(){Object.defineProperty(Function.prototype,"once",{value:function(){return n(this)},configurable:!0})})},{}],10:[function(e,t){function n(e,t,n){if(!u(t))throw new TypeError("iterator must be a function");arguments.length<3&&(n=this),"[object Array]"===a.call(e)?r(e,t,n):"string"==typeof e?o(e,t,n):i(e,t,n)}function r(e,t,n){for(var r=0,o=e.length;o>r;r++)s.call(e,r)&&t.call(n,e[r],r,e)}function o(e,t,n){for(var r=0,o=e.length;o>r;r++)t.call(n,e.charAt(r),r,e)}function i(e,t,n){for(var r in e)s.call(e,r)&&t.call(n,e[r],r,e)}var u=e("is-function");t.exports=n;var a=Object.prototype.toString,s=Object.prototype.hasOwnProperty},{"is-function":8}],11:[function(e,t,n){function r(e){return e.replace(/^\s*|\s*$/g,"")}n=t.exports=r,n.left=function(e){return e.replace(/^\s*/,"")},n.right=function(e){return e.replace(/\s*$/,"")}},{}],12:[function(e,t){var n=e("trim"),r=e("for-each"),o=function(e){return"[object Array]"===Object.prototype.toString.call(e)};t.exports=function(e){if(!e)return{};var t={};return r(n(e).split("\n"),function(e){var r=e.indexOf(":"),i=n(e.slice(0,r)).toLowerCase(),u=n(e.slice(r+1));"undefined"==typeof t[i]?t[i]=u:o(t[i])?t[i].push(u):t[i]=[t[i],u]}),t}},{"for-each":10,trim:11}],13:[function(e,t){function n(){for(var e={},t=0;t<arguments.length;t++){var n=arguments[t];for(var o in n)r.call(n,o)&&(e[o]=n[o])}return e}t.exports=n;var r=Object.prototype.hasOwnProperty},{}],14:[function(e,t){"use strict";function n(e,t,n){function s(e,t){var n={body:JSON.stringify(e),uri:c,method:"POST",headers:{"Content-Type":"application/json"}};r(n,function(e,n,r){var o=JSON.parse(r);o.features=o.features.map(function(e){var t={type:"Feature",properties:e.properties,geometry:{type:"LineString",coordinates:i.decode(e.geometry,6).map(function(e){return[e[1],e[0]]})}};return t}),t(e,o)})}t=t||{};var f;t.mapMatchAPI?f=t.mapMatchAPI:a.indexOf(t.profile)>=0?f="https://api.tiles.mapbox.com/matching/v4/mapbox."+t.profile+".json":n(new Error("Need either mapmatchAPI endpoint or profile of "+a.join(", ")));for(var c=f+"?access_token="+L.mapbox.accessToken+"&geometry=polyline",p=u(),l=o.tidy(e,{minimumDistance:t.gpsPrecision||10,minimumTime:5,maximumPoints:100}),d=0;d<l.features.length;d++)p.defer(s,l.features[d]);p.awaitAll(function(e,r){for(var o=r[0],i=1;i<r.length;i++)o.features.push(r[i].features[0]);if("geojson"==t.output)n(e,o);else{var u=L.mapbox.featureLayer(o);n(e,u)}})}var r=e("xhr"),o=e("geojson-tidy"),i=e("polyline"),u=e("queue-async"),a=["driving","walking","cycling"];t.exports=function(e,t,r){return r||(r=t,t={}),new n(e,t,r)}},{"geojson-tidy":2,polyline:4,"queue-async":5,xhr:6}]},{},[1])(1)});